index.html :

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>final-eval-shopping-cart-modern</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>


src/style.css :

@import "tailwindcss";


src/main.js :

import { createApp } from 'vue'
import './style.css'
import App from './App.vue'
import { createPinia } from 'pinia'

import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)


const app = createApp(App)
    app.use(pinia)
    app.mount('#app')

src/App.vue :

<script setup>
import AppFooter from './components/AppFooter.vue';
import AppHeader from './components/AppHeader.vue';
import Cart from './components/shop/Cart.vue';
import ProductList from './components/shop/ProductList.vue';


</script>

<template>
  <!-- Header -->
   <AppHeader />

   <!-- Main -->
    <main class="container mx-auto py-8 px-4 flex flex-wrap">
      <section class="w-full md:w-2/3 px-4 mb-8">
        <ProductList
          apiURL="https://692fc3d9778bbf9e006e6a45.mockapi.io/"
        />
      </section>

      <aside class="w-full md:w-1/3 px-4">
        <Cart />
      </aside>
    </main>

    <!-- Footer -->
    <AppFooter />
</template>

<style scoped>

</style>



src/ui/MyButton.vue :

<template>
    <div>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            <slot />
        </button>
    </div>
</template>

src/stores/shoppingCart.js :

import { defineStore } from "pinia";

export const useShoppingCartStore = defineStore('shoppingCart', {
    // states:
    state: () => ({
        cart: [],
        shipping: 5,
        vatRate: 0.21
    }),

    // getters:
    getters: {
        totalHTVA (state) {
            return state.cart.reduce(
                    (total, item) => total + item.price * item.qty, 
                0);
        },

        tva (){
            return this.totalHTVA * this.vatRate
        },

        totalGeneral () {
            return this.totalHTVA + this.tva + this.shipping
        }
    },

    // actions:
    actions: {
        setShipping(value) {
            this.shipping = value
        },


        addToCart(product) {
            const existing = this.cart.find((i) => i.id === product.id)

            if (existing) {
                existing.qty++
            } else {
                this.cart.push({
                    id: product.id,
                    title: product.title,
                    price: product.price,
                    image: product.image,
                    qty: 1
                })
            }
        },

        removeFromCart(id) {
            const index = this.cart.findIndex((i) => i.id === id)
            if (index !== -1) this.cart.splice(index, 1)
        },

        updateQty(id, qty) {
            const item = this.cart.find((i) => i.id === id)
            if (!item) return;

            if (qty <= 0) {
                this.removeFromCart(id)
            } else {
                item.qty = qty
            }
        }
    },
    persist: true
})


src/stores/products.js :

import { defineStore } from "pinia";
import DB from "../services/DB";

export const useProductsStore = defineStore('products', {
    // state:
    state: () => ({
        products: []
    }),

    // getters:
    getters: {

    },


    // actions:
    actions: {
        async init (url) {
            DB.setApiURL(url)
            this.products = await DB.findAllProducts()
        }
    }
})


src/services/DB.js :



export default class DB {
    static setApiURL(url) {
        this.apiURL = url
    }

    static async findAllProducts() {
        const res = await fetch(this.apiURL + 'products')
        return res.json()
    }
}

src/components/AppHeader.vue :

<template>
    <div>

        <header class="bg-gray-900 text-white py-4">
            <div class="container mx-auto flex justify-between items-center px-4">
                <div class="flex items-center shrink-0 text-white mr-6">
                    <span class="font-bold text-xl">EAFC Magasin en ligne</span>
                </div>
                <button
                    id="menu-toggle"
                    class="flex items-center px-3 py-2 border rounded text-gray-500 border-gray-600 hover:text-white hover:border-white"
                >
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </button>
            </div>
        </header>

    </div>
</template>

src/components/AppFooter.vue :

<template>
    <div>
        <footer class="bg-gray-900 text-white py-4">
            <div class="container mx-auto px-4">
                <p class="text-center">
                    &copy; 2024 EAFC Magasin en ligne. Tous droits réservés.
                </p>
            </div>
        </footer>
    </div>
</template>


src/components/shop/ProductList.vue :

<template>
    <div>
        <h1 class="text-3xl fond-bold mb-4">Nouveaux produits</h1>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <ProductCard 
                v-for="p in products"
                :key="p.id"
                :product="p"
            />
        </div>
    </div>
</template>

<script setup>
import { onMounted } from 'vue';
import { useProductsStore } from '../../stores/products';
import ProductCard from './ProductCard.vue';
import { storeToRefs } from 'pinia';

const productStore = useProductsStore()
const { init } = productStore // only for actions we destructure on the store object

const { products } = storeToRefs(productStore) // only for state & getters we destructure with storeToRefs()

onMounted(() => {
    init(props.apiURL)
})

const props = defineProps({
    apiURL: {
        type: String,
        required: true
    }
})
</script>


src/components/shop/ProductCard.vue :

<template>
    <div>
        <article class="bg-white rounded-lg overflow-hidden shadow-mid">
            <img 
                :src="product.image" 
                :alt="product.title"
                class="w-full"
            />
            <div class="p-4">
                <h2 class="font-bold text-lg mb-2 text-black">{{ product.title }}</h2>
                <p class="text-gray-700">{{ product.price }}€</p>
                <button
                    class="mt-4 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                    @click="addToCart(product)"
                >
                    Ajouter
                </button>
            </div>
        </article>
    </div>
</template>

<script setup>
import { useShoppingCartStore } from '../../stores/shoppingCart';

const shoppingCart = useShoppingCartStore()

const { addToCart } = shoppingCart // it's a actions so we destructure directly from the store object

const props = defineProps({
    product: {
        type: Object,
        required: true
    }
})
</script>


src/components/shop/CartItem.vue ;

<template>
    <div>
        <li class="flex justify-between items-center py-3 text-black">
            <div>
                <img 
                    :src="item.image" 
                    :alt="item.title"
                    class="h-12 w-12 rounded-full mr-4"
                />
                <div>
                    <span class="font-semibold">{{ item.title }}</span>
                    <span class="block text-sm">{{ item.price }}€</span>
                </div>
            </div>

            <div>
                <input 
                    type="number"
                    class="w-16 text-center border-rounded"
                    :value="item.qty"
                    min="0"
                    @input="updateQty(item.id, +$event.target.value)"
                />

                <button
                    class="ml-2 text-red-500"
                    @click="removeFromCart(item.id)"
                >
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            </div>
        </li>
    </div>
</template>

<script setup>
import { useShoppingCartStore } from '../../stores/shoppingCart';

const shoppingCart = useShoppingCartStore()

const {removeFromCart, updateQty} = shoppingCart

const props = defineProps({
    item: {
        type: Object,
        required: true
    }
})
</script>

src/components/shop/Cart.vue :

<template>
    <div>
        <div class="bg-white rounded-lg shadow">
            <ul class="divide-y divide-gray-200 p-6">
                <CartItem 
                    v-for="p in cart"
                    :key="p.id"
                    :item="p"
                />
            </ul>
        </div>

        <div class="bg-gray-50 p-6 text-black">
            <div class="flex justify-between font-bold text-xl">
                <span>Total HTVA:</span>
                <span>{{ totalHTVA.toFixed(2) }}€</span>
            </div>
        </div>

        <div class="flex justify-between mb-1">
            <span><strong>TVA (21%)</strong></span>
            <span>{{ tva.toFixed(2) }}€</span>
        </div>

        <div class="flex justify-between items-center my-6">
            <span><strong>Livraison:</strong></span>
            <select 
                class="py-1 px-2 rounded border border-gray-300 ml-2"
                v-model.number="shipping"
                @change="setShipping(+$event.target.value)"
            >
                <option value="5" class="text-black">Standard - 5€</option>
                <option value="15" class="text-black">Express - 15€</option>
            </select>
        </div>

        <div class="flex justify-between font-bold text-xl">
            <span><strong>Total Général</strong></span>
            <span>{{ totalGeneral.toFixed(2) }}€</span>
        </div>

        <MyButton
            class="w-full"
        >
            Procéder au paiement
        </MyButton>

    </div>
</template>

<script setup>
import { storeToRefs } from 'pinia';
import { useShoppingCartStore } from '../../stores/shoppingCart';
import CartItem from './CartItem.vue';
import MyButton from '../../ui/MyButton.vue';

const shoppingCart = useShoppingCartStore()

const { setShipping } = shoppingCart
const {cart, totalHTVA, tva, totalGeneral, shipping} = storeToRefs(shoppingCart)
</script> 